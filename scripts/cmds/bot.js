const axios = require("axios");

module.exports = {
  config: {
    name: "bot",
    version: "2.5",
    author: "Nazrul | Fixed By LIKHON AHMED",
    countDown: 5,
    role: 0,
    description: "chat with bot using API + random replies",
    category: "chat",
    guide: {
      en: "{p}bot <message>"
    }
  },

  onStart: async ({ api, event, args, usersData }) => {
    const data = await usersData.get(event.senderID);
    const name = data.name || "Friend";

    const userMsg = args.join(" ");
    if (!userMsg) {
      return api.sendMessage("Example: /bot hi", event.threadID);
    }

    try {
      const url = `http://65.109.80.126:20392/sim?type=ask&ask=${encodeURIComponent(userMsg)}`;
      const res = await axios.get(url);
      const replyText = res.data?.data?.msg || "ЁЯе▓ ржЖржорж┐ ржХрж┐ржЫрзБ ржмрзБржЭрждрзЗ ржкрж╛рж░рж▓рж╛ржо ржирж╛ред";

      return api.sendMessage(
        `тАОтХнтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЭН\nтХ░тЮд ЁЯСд ЁЭРГЁЭРЮЁЭРЪЁЭРлуАО ${name} уАП,\nтХ░тЮд ЁЯЧг ${replyText}\nтХ░тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЮд`,
        event.threadID,
        event.messageID
      );
    } catch (err) {
      return api.sendMessage("тЪа API error: " + err.message, event.threadID);
    }
  },

  onChat: async ({ api, event, usersData }) => {
    const text = event.body?.trim();
    if (!text) return;

    
    if (text.startsWith("/")) return;

    
    if (/^\d+$/.test(text) || text.length === 1) return;

    const data = await usersData.get(event.senderID);
    const name = data.name || "Friend";

    const randomMessages = [
      "ржПрждрзЛ ржмржЯ ржмржЯ ржХрж░рж▓рзЗ рж▓рж┐ржн ржирж┐ржмрзЛ ржХрж┐ржирзНрждрзБ ЁЯШТ",
      "рж╕рж╛ржжрж╛ рж╕рж╛ржжрж╛ ржХрж╛рж▓рж╛ ржХрж╛рж▓рж╛ ржЖржорж┐ ржорж╛ржирзБрж╖ ржЕржирзЗржХ ржнрж╛рж▓рж╛ ЁЯШБ",
      "рж╣рзБржо ржЬрж╛ржи ржмрж▓рзЛ рж╢рзБржиржЫрж┐...ЁЯШЧ",
      "ржЖржорж╛ржХрзЗ ржирж╛ ржбрзЗржХрзЗ рж▓рж┐ржЦржи ржмрж╕ рж░рзЗ ржПржХржЯрж╛ ржЧрзЛржл ржжрзЗ",
      "ржЖрж╣ рж╢рзЛржирж╛ ржЖржорж╛рж░ ржЖржорж╛ржХрзЗ ржПрждрзЛ ржбрж╛ржХрзНрждрж╛ржЫрзЛ ржХрзЗржирзЛ ржЖрж╕рзЛ ржмрзБржХрзЗ ржЖрж╢рзЛЁЯе▒",
      "рждрзЛрж░ рж╕рж╛рж╣рж╕ ржХрзНржпрж╛ржоржирзЗ рж╣ржЗрж▓рзЛ ржЖржорж╛ржХрзЗ ржмржЯ ржмрж▓рзЗ ржбрж╛ржХрзЛрж╕ ЁЯШд",
      "рждрзБржЗ ржирж┐ржЬрзЗ ржмржЯ ЁЯШТЁЯФк",
      "ржирж╛ ржЪрж┐рж▓рзНрж▓рж╛ржЗрзЯрж╛ ржПржмрж╛рж░ ржХрзЛ рж╢рзБржиржЫрж┐ ",
      "ржжрзБржЗ ржорж┐ржирж┐ржЯ рж╕рж╛ржЗржбрзЗ ржЖрж╕рж┐рж╕ рждрзЛ ржХржерж╛ ржЖржЫрзЗ ЁЯШ╛ЁЯФк",
      "ржжрзБржЗ ржЯрж╛ржХрж╛ ржжрж┐рзЯрзЗ ржорж┐рж╕ ржХрж▓ ржжрж┐рждрзЗ ржЧрж┐рзЯрзЗ ржПржЦржи ржжрзЗржЦрж┐ ржжрж╢ ржЯрж╛ржХрж╛ ржЦрж░ржЪ рж╣рзЯрзЗ ржЧрзЗржЫрзЗ ЁЯШЯ",
      "ржЖрж░ ржпрж╛ржмрзЛ ржирж╛ ржмрзЗржЧрзБржи рждрзБрж▓рж┐рждрзЗ ЁЯдн",
      "ржЖржорж┐ ржЖржкржирж╛ржХрзЗ ржХрж┐ржнрж╛ржмрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рждрзЗ ржкрж╛рж░рж┐...? ЁЯдФ",
      "ржЖржжрзЗрж╢ ржХрж░рзБржи ржмрж╕...ЁЯЩВ",
      "рж╣рзБржо рж╢рзБржиржЫрж┐ ржЖржорж┐ ржЖржкржирж┐ ржмрж▓рзБржи ЁЯШР",
      "ржЖржорж╛рж░ рж╕ржм ржХржорж╛ржирзНржб ржжрзЗржЦрждрзЗ /help ржЯрж╛ржЗржк ржХрж░рзБржи тЬЕ",
      "ржЖрж╕рж╕рж╛рж▓рж╛ржорзБ'ржЖрж▓рж╛ржХрзБржо ржЬрж┐ ржмрж▓рзБржи ржХрж┐ ржХрж░рждрзЗ ржкрж╛рж░рж┐ ржЖржкржирж╛рж░ ржЬржирзНржп ЁЯШК",
      "ржЖржжрзЗрж╢ ржХрж░рзБржи ржпрж╛рж╣рж╛ржкрж╛ржирж╛ ЁЯШО",
      "ржЖржмрж╛рж░ ржпржжрж┐ ржЖржорж╛рж░рзЗ ржмржЯ ржХржЗрзЯрж╛ ржбрж╛ржХ ржжрзЗржЫ рждрж╛ржЗрж▓рзЗ рждрзЛрж░ ржмрж┐ржпрж╝рзЗ рж╣ржмрзЗ ржирж╛ ЁЯлдЁЯШП",
      "рждрзЛржЧрзЛ ржмрж╛рзЬрж┐рж░ ржЬрж╛ржорж╛ржЗ ржЖржорж┐ рж╕ржорзНржорж╛ржи ржжрзЗ ЁЯШ╝",
      "рждрзБржЗ ржмржЯ рждрзЛрж░ ржирж╛ржирж┐ ржмржЯ ЁЯШд рждрзЛрж░ ржХржд ржмрзЬ рж╕рж╛рж╣рж╕ рждрзБржЗ ржЖржорж╛рж░рзЗ ржмржЯ ржХрж╕ ЁЯШд",
      "ржЖржкржирж╛рж░ ржХрж┐ ржЪрж░рж┐рждрзНрж░рзЗ рж╕ржорж╕рзНржпрж╛ ржпрзЗ ржПрждрзЛ ржмрж╛рж░ ржЖржорж╛ржХрзЗ ржбрж╛ржХрждрзЗржЫрзЗржи ЁЯди",
      "ржбрж╛ржХржЫрзЛржд ржХрзЗржи ржлрж╛рж╕рзНржЯ ржХрзЛ ЁЯШТ",
      "рждрзБржорж┐ ржХрж┐ ржЖржорж╛ржХрзЗ ржбрзЗржХрзЗржЫрзЛ...? ЁЯШЗ"
    ];

    
    if (event.type === "message_reply" && event.messageReply?.senderID === api.getCurrentUserID()) {
      try {
        const url = `http://65.109.80.126:20392/sim?type=ask&ask=${encodeURIComponent(text)}`;
        const res = await axios.get(url);
        const replyText = res.data?.data?.msg || "ЁЯе▓ ржЖржорж┐ ржХрж┐ржЫрзБ ржмрзБржЭрждрзЗ ржкрж╛рж░рж▓рж╛ржо ржирж╛ред";

        return api.sendMessage(
          `тАОтХнтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЭН\nтХ░тЮд ЁЯСд ЁЭРГЁЭРЮЁЭРЪЁЭРлуАО ${name} уАП,\nтХ░тЮд ЁЯЧг ${replyText}\nтХ░тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЮд`,
          event.threadID,
          event.messageID
        );
      } catch (err) {
        return api.sendMessage("тЪа API error: " + err.message, event.threadID);
      }
    }

    
    const lowerText = text.toLowerCase();
    if (
      lowerText.includes("bot") ||
      lowerText.includes("ржмржЯ") ||
      lowerText.includes("robot") ||
      lowerText.includes("рж░рзЛржмржЯ")
    ) {
      const randomMessage = randomMessages[Math.floor(Math.random() * randomMessages.length)];

      return api.sendMessage(
        `тАОтХнтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЭН\nтХ░тЮд ЁЯСд ЁЭРГЁЭРЮЁЭРЪЁЭРлуАО ${name} уАП,\nтХ░тЮд ЁЯЧг ${randomMessage}\nтХ░тФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтЮд`,
        event.threadID,
        event.messageID
      );
    }
  }
};
